#Nama   : Yalvi Hidayat
#NPM    : 6181801044

#UTS STAT R

#########################################

#INSTALL LIBRARY
library(ggplot2)
library(datasets)
library(dplyr)
library(TeachingDemos)
library(mlbench)
library(mosaicData)
library(EnvStats)
library("Hmisc")

#1 Manajemen Data

#a
badminton_player <- read.csv('BWF_players1.csv')
na_data <- badminton_player[!complete.cases(badminton_player),]

#b
not_na_badminton <- badminton_player[complete.cases(badminton_player),]
rownames(not_na_badminton) <- not_na_badminton$Name
not_na_badminton <- subset(not_na_badminton,select = c('Age','Height','Gender','Category','Country','Continent','Hand','Medals','HRank','Multiple','Career'))

#c ubah ke factor
not_na_badminton$Gender <- as.factor(not_na_badminton$Gender)
not_na_badminton$Category <- as.factor(not_na_badminton$Category)
not_na_badminton$Country <- as.factor(not_na_badminton$Country)
not_na_badminton$Continent <- as.factor(not_na_badminton$Continent)
not_na_badminton$Hand <- as.factor(not_na_badminton$Hand)

str(not_na_badminton)

#2 Analisis Data Eksploratif

#a
attach(not_na_badminton)

#Age
par(mfrow = c(2,2))
h1 <- hist(not_na_badminton$Age, 
           main = "Histogram Umur Pemain Bulu Tangkis",
           xlab = "Umur")
xfit<-seq(min(not_na_badminton$Age),max(not_na_badminton$Age),length=40)
yfit<-dnorm(xfit,mean=mean(not_na_badminton$Age),sd=sd(not_na_badminton$Age))
yfit<-yfit*diff(h1$mids[1:2])*length(not_na_badminton$Age)
lines(xfit, yfit, col="red", lwd=2)

#Gender
ggplot(not_na_badminton, aes(x = Gender, fill=factor(Gender)))+
  geom_bar()+
  xlab("Jenis Kelamin")+
  ylab("Frequency")+
  ggtitle("Barplot Gender dalam Permainan Bulu Tangkis")+
  guides(fill=guide_legend("Jenis Kelamin"))+
  scale_fill_brewer(palette="Set2")+
  theme(panel.background = element_blank())

#Continent
ggplot(not_na_badminton, aes(x = "", y = Continent,fill=factor(Continent)))+
  geom_bar(stat = "identity", width = 1)+
  ggtitle("Piechart Asal Continent Pemain Bulu Tangkis")+
  guides(fill=guide_legend("Kontinen"))+
  coord_polar("y",start=0)+
  theme_void()+
  scale_fill_brewer(palette="Set2")

#Medals
ggplot(not_na_badminton, aes(x = Medals))+
  geom_density(color="orange",fill="orange")+
  ggtitle("Density Plot Jumlah Peraihan Medali Major Event")+
  theme(panel.background = element_blank())

#b Bivariat

#Career vs Continent
ggplot(not_na_badminton, aes(x=Career, y=Continent))+ 
  geom_boxplot(color='black',fill="orange")+
  xlab("Jumlah Karir")+
  ylab("Kontinen")+
  ggtitle("Boxplot Hubungan Antara Karir dengan Kontinen")+
  theme(panel.background = element_blank())

#Career vs Medals
ggplot(not_na_badminton, aes(x=Career, y=Medals))+ 
  geom_point(color='darkgreen',fill="darkgreen")+
  xlab("Jumlah Karir")+
  ylab("Jumlah Peraihan Medali")+
  ggtitle("Scatterplot Hubungan Antara Karir dengan Jumlah Medali")+
  theme(panel.background = element_blank())+
  geom_smooth(method = 'lm')

#Hand vs Category
ggplot(not_na_badminton, aes(x=Hand,fill=Category)) +
  geom_bar(position = "stack")+
  xlab("Hand")+
  ylab("Freq")+
  ggtitle("Stacked Barplot Hubungan Posisi Tangan dengan Kategori")+
  theme(panel.background = element_blank())+
  scale_fill_brewer(palette="Set2")

detach(not_na_badminton)

#3 UJI STATISTIK

#a 

attach(not_na_badminton)

#dataframe for only Europe and Asia
europe_player <- filter(not_na_badminton, Continent=="Europe")
asia_player <- filter(not_na_badminton,Continent=="Asia")

#var test Memang sama datanya.
var.test(europe_player$Height,asia_player$Height,alternative = "two.sided")

#normality test
shapiro.test(europe_player$Height)
shapiro.test(asia_player$Height)

#lakukan T-Test. H0 diterima
t.test(europe_player$Height,asia_player$Height,alternative = "greater",mu=3)

#b
anovaMedal <- aov(Medals ~ Country,data=europe_player)
summary(anovaMedal)

#hasilnya signifikan dan berikut list negaranya
TukeyHSD(anovaMedal)

#yang paling signifikan itu yang kecil-kecil ya (ulah nu badag)

#c

#buat kolom baru
col_new_badminton <- data.frame(not_na_badminton)

col_new_badminton$cat_age = "aeu"
for (i in 1:dim(col_new_badminton)[1]) {
  if(col_new_badminton$Age[i] >= 0 & col_new_badminton$Age[i] < 25){
    col_new_badminton$cat_age[i] = "Young"
  } else if(col_new_badminton$Age[i] >= 25 & col_new_badminton$Age[i] < 30) {
    col_new_badminton$cat_age[i] = "Middle"
  } else {
    col_new_badminton$cat_age[i] = "Senior"
  }
}

table(col_new_badminton$cat_age, col_new_badminton$Category)

#uji masing ANOVA
summary(aov(HRank ~ cat_age,data=col_new_badminton)) #cat_age
summary(aov(HRank ~ Category,data=col_new_badminton)) #category badminton

#uji ANOVA 2 ARAH dan interaksinya
two.way <- aov(HRank ~ cat_age + Category, data = col_new_badminton)
interaction <- aov(HRank ~ cat_age*Category, data = col_new_badminton)
summary(two.way)
summary(interaction)

#TUKEY HSD
TukeyHSD(two.way)
TukeyHSD(interaction)

#4
#Persamaan ada d pdf ya

#modelnya
attach(not_na_badminton)

not_na_badminton$Country <- relevel(not_na_badminton$Country, ref = "Indonesia")

badminton.model <- lm(Career ~ Age + Gender + Country + Hand + Medals + HRank + Multiple + Age*Multiple + Medals*HRank, data = not_na_badminton)
summary(badminton.model)

#jawaban semua ada di pdf

#5

#a
attach(not_na_badminton)
str(not_na_badminton)
interaction.plot(x.factor = Gender, 
                 trace.factor = Country, 
                 response = Career, 
                 main="Interaction Plot of Career by Gender*Country", 
                 xlab = "Gender", ylab = "Career",
                 col=c("red","blue","green"))

interaction.plot(x.factor = Hand, 
                 trace.factor = Country, 
                 response = Career, 
                 main="Interaction Plot of Career by Hand*Country", 
                 xlab = "Hand", ylab = "Career",
                 col=c("red","blue","green"))

no_factor_badminton <- data.frame(not_na_badminton)
no_factor_badminton <- subset(no_factor_badminton,select = c('Age','Height','Medals','HRank','Multiple'))
res <- cor(no_factor_badminton)
round(res,2)

#b
custom_model <- lm(Career ~ Age*Gender + Hand*Gender + Medals*Height + Country + Multiple, data = not_na_badminton)
summary(custom_model)
AIC(custom_model)

#c

#Backward
backward_mdl <- step(custom_model,direction = "backward")
summary(backward_mdl)
AIC(backward_mdl)
extractAIC(backward_mdl)

#Stepwise
stepwise_mdl <- step(custom_model,direction = "both")
summary(stepwise_mdl)
AIC(stepwise_mdl)
extractAIC(stepwise_mdl)

#R dan AIC nnti bisa dituliskan di pdf saja

#d
new_na_data <- data.frame(na_data, regression = predict(custom_model, data.frame(na_data)))
merge(na_data, new_na_data, all.y = TRUE)
new_na_data <- subset(new_na_data,select = c('Name','Age','Height','Gender','Category','Country','Continent','Hand','Medals','HRank','Multiple','regression'))
colnames(new_na_data)[colnames(new_na_data)=='regression'] <- 'Career'

#e
na_data_real <- read.csv('na_real.csv')
merged_data <- cbind(new_na_data,na_data_real)

#paired t-test

#shapiro test
shapiro.test(merged_data$Career)
shapiro.test(merged_data$RealCareer)

#var test
var.test(merged_data$Career,merged_data$RealCareer,alternative = "two.sided")

#paired t-test
t.test(merged_data$Career,merged_data$RealCareer,paired = T)

#H0 ditolak, Ha diterima. Terdapat Perbedaan yang signifikan
